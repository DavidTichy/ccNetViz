<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ccNetViz by David Tichy</title>

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>ccNetViz</h1>
        <p>JavaScript library for visualization of large-scale network graphs using WebGL</p>
        <p class="view"><a href="https://github.com/DavidTichy/ccNetViz">View the Project on GitHub <small>DavidTichy/ccNetViz</small></a></p>
        <ul>
          <li><a href="https://github.com/DavidTichy/ccNetViz/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/DavidTichy/ccNetViz/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/DavidTichy/ccNetViz">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>Overview</h3>
        <p>ccNetViz is a lightweight (22kB minified), high performance javascript library for network graphs visualization. It enables custom styling of nodes and edges, dynamic changes of the network and basic graph interactivity.</br>
            Used for example by <a href="http://cellcollective.org">Cell Collective</a> project.</br>
            ccNetViz is open source library available under <a href="http://www.gnu.org/licenses/gpl-3.0.en.html">GPLv3 License</a>.
        </p>
        <div class="container">
            <div>
	            <canvas id="drosophila"/>
            </div>
            <i>Use mouse to pan and zoom in the graph.</i>
	    </div>
        <div class="container">
            <div>
                <canvas id="macrophage"/>
            </div>
        </div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/DavidTichy">David Tichy</a></p>
      </footer>
    </div>

    <script src="js/scale.fix.js"></script>
    <script src="js/ccNetViz.min.js"></script>
    <script src="js/utils.js"></script>

    <script type="text/javascript">
        var graphs = [];

        function create(id, styles, color, action) {
            utils.ajax("http://davidtichy.github.io/ccNetViz/data/" + id + ".json", null, function(data) {
                var nodes = data.nodes;
                color && (nodes = nodes.map(function(e) {
                    return { label: e.label, style: e.style, color: color };
                }));
                var edges = data.edges.map(function(e) {
                    return { source: nodes[e.source], target: nodes[e.target], style: e.style }
                });
                var graph = new ccNetViz(document.getElementById(id), { styles: styles });
                graph.set(nodes, edges, "force");
                graph.draw();
                graphs.push(graph);
                action && action(graph);
            });
        }

        create("drosophila", {
            node: { label: { hideSize: 14 } },
            edge: { arrow: { texture: "images/arrow.png", hideSize: 2 } },
            internal: { texture: "images/red.png" },
            external: { texture: "images/orange.png" },
            positive: { color: "rgb(171, 237, 199)" },
            negative: { color: "rgb(244, 172, 164)" }
        });
        create("macrophage", {
            background: { color: "rgb(35, 35, 35)" },
            node: { minSize: 8, texture: "images/circle.png", label: { hideSize: 16 } },
            edge: { color: "rgb(86, 86, 86)", arrow: { texture: "images/arrow.png", hideSize: 2 } }
        }, new ccNetViz.color(1, 1, 1), function(graph) {
            var def = new ccNetViz.color(1, 1, 1);
            var colors = graph.nodes.map(function() {
                return def;
            });
            var max = 20;
            var duration = 50;
            var nodes = {};

            setInterval(function() {
                var c = 0, remove = [];
                for (var p in nodes) {
                    var e = nodes[p];
                    ++e.time > duration ? remove.push(p) : c += (duration - e.time);
                }
                for (var i = 0; i < remove.length; i++) {
                    delete nodes[remove[i]];
                }
                Math.random() > c / (duration * max) && (nodes[Math.floor(Math.random() * colors.length)] = { time: 0 });

                for (var p in nodes) {
                    colors[p] = new ccNetViz.color(Math.abs(2*nodes[p].time / duration - 1), 1, 1);
                }

                graph.update("nodesColored", "color", colors);
                graph.draw();
            }, 200);
        });

        window.addEventListener('resize', function() {
            graphs.forEach(function(graph) {
                graph.resize();
                graph.draw();
            });
        });
	</script>
  </body>
</html>